### Redis 简单的分布式锁

- 锁的定义
  - key/value 结构中 key
  - SET key:value(随机值如UUID等) NX PX 30000
- 互斥性的保障
  - key/value 结构中 key 的唯一性
- 死锁的避免
  - 给 key 设置过期时间
- 锁的删除
  - 获取 key 的 value 与自己的对比，一致才通过执行 lua 脚本删除
- 锁获取失败后的行为
  - 轮询再次获取
- 存在的问题
  - redis 单点故障  --> 主从
  - 简单主从的异步同步数据过程导致锁丢失
  - 没有 zk 分布式锁稳定



### 基于 RedLock 算法的分布式锁

- 主要针对上述简单 redis 分布式锁的单点故障
- 实现思想：
  - 在集群的 (N/2 + 1) 个节点上都上锁成功才算成功
  - 上锁失败执行 lua 脚本依次删除锁



### Zookeeper 分布式锁

- 锁的定义
  - 临时(顺序)节点
- 互斥性的保障
  - 相同名称的临时节点只有一个能创建成功
- 死锁的避免
  - server 与 client 端的会话关闭时会清除与之关联的所有临时节点
- 锁的删除
  - 客户端删除
- 锁获取失败后的行为
  - 注册监听提监听锁的状态变化以便进行进一步的处理

