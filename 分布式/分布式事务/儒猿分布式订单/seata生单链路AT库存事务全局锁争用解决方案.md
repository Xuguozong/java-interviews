> 问题背景：
>
> 库存数据，**一个商品就一条库存数据**，如果有很多人同时购买一个商品，必然导致这里，**多个分布式事务都会去竞争和等待同一个商品的一条库存数据的全局锁**



**三个方案**

1. 做的极为极为的复杂，库存表 -> 库存分段，一个商品就一条库存数据，一个商品有n多条库存数据，1w件库存，就是可以分为1000条库存数据，每条库存数据里可以扣的库存就10个，写一套非常复杂的逻辑和算法，每次扣减库存的时候，需要去按照一定的规则和算法，去选择一个库存分片去扣减 ----  **全局锁变为分段锁的思想**
2. RocketMQ **柔性事务方案，替换掉seata刚性事务方案**，在国内绝大多数的互联网公司里，一般来说，重要的业务系统，一般都是使用mq柔性事务，大多情况下，一般来说都能确保数据是一致的
3. 用没有全局锁的分布式事务方案，TCC，seata支持AT、TCC、Saga、XA事务方案，seata AT+TCC混合分布式事务方案