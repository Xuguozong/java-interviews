### 随机查询性能抖动

**现象：**有时候我们在数据库里执行查询或者更新语句的时候，可能SQL语句的性能会出现不正常的莫名其妙的抖动，平时可能几十毫秒搞定的，现在居然要几秒钟

**可能的原因：**

- 可能buffer pool的缓存页都满了，此时你执行一个SQL查询很多数据，一下子要把很多缓存页flush到磁盘上
  去，刷磁盘太慢了，就会导致你的查询语句执行的很慢
- 可能你执行更新语句的时候，redo log在磁盘上的所有文件都写满了，此时需要回到第一个redo log文件覆
  盖写，覆盖写的时候可能就涉及到第一个redo log文件里有很多redo log日志对应的更新操作改动了缓存页，那些缓
  存页还没flush到磁盘，此时就必须把那些缓存页flush到磁盘，才能执行后续的更新语句，那你这么一等待，必然会导
  致更新执行的很慢了

**应对措施：**

- 尽量减少缓存页flush到磁盘的频率
- 尽量提升缓存页flush到磁盘的速度
  - 存储硬件采用 SSD 固态硬盘，提高随机 IO 性能
  - 调整**刷盘的 IO 速率** **`innodb_io_capacity`**,将其调为与 SSD 的 IOPS 一致(**使用 fio 工具测试**)
  - 实际刷盘按照：**`innodb_io_capacity`** 乘以 **`innodb_max_dirty_pages_pct(脏页比例，默认 75%，一般不用动)`**
  - **`innodb_flush_neighbors`** 是否刷相邻缓存页，设置为 0，禁止刷相邻缓存页